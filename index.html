<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sahitya Mela - Professional Book Publishing Platform</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #f8f9fa;
            color: #212529;
            line-height: 1.6;
        }
        
        header {
            background: #ffffff;
            border-bottom: 1px solid #e9ecef;
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 4px rgba(0,0,0,0.04);
        }
        
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo-section {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .logo-icon {
            font-size: 1.75rem;
        }
        
        h1 {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1a73e8;
            letter-spacing: -0.5px;
        }
        
        .header-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }
        
        .user-info {
            display: none;
            align-items: center;
            gap: 1rem;
            padding: 0.5rem 1rem;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .user-email {
            font-size: 0.875rem;
            color: #495057;
            font-weight: 500;
        }
        
        .btn {
            padding: 0.625rem 1.5rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9375rem;
            font-weight: 600;
            transition: all 0.2s;
            font-family: inherit;
        }
        
        .btn-primary {
            background: #1a73e8;
            color: white;
        }
        
        .btn-primary:hover {
            background: #1557b0;
            box-shadow: 0 2px 8px rgba(26, 115, 232, 0.3);
        }
        
        .btn-secondary {
            background: #ffffff;
            color: #5f6368;
            border: 1px solid #dadce0;
        }
        
        .btn-secondary:hover {
            background: #f8f9fa;
            border-color: #5f6368;
        }
        
        .btn-outline {
            background: transparent;
            color: #1a73e8;
            border: 1px solid #1a73e8;
        }
        
        .btn-outline:hover {
            background: #e8f0fe;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }
        
        .hero {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 4rem 2rem;
            text-align: center;
            margin-bottom: 3rem;
        }
        
        .hero h2 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            letter-spacing: -1px;
        }
        
        .hero p {
            font-size: 1.125rem;
            opacity: 0.95;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }
        
        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #202124;
        }
        
        .books-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 2rem;
            margin-bottom: 4rem;
        }
        
        .book-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid #e9ecef;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .book-card:hover {
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
            transform: translateY(-4px);
            border-color: #1a73e8;
        }
        
        .book-cover {
            width: 100%;
            height: 320px;
            background-size: cover;
            background-position: center;
            background-color: #f8f9fa;
        }
        
        .book-cover-placeholder {
            width: 100%;
            height: 320px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
        }
        
        .book-info {
            padding: 1.5rem;
        }
        
        .book-title {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #202124;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .book-author {
            color: #5f6368;
            font-size: 0.875rem;
            margin-bottom: 0.75rem;
            font-weight: 500;
        }
        
        .book-description {
            color: #5f6368;
            font-size: 0.875rem;
            line-height: 1.5;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
            margin-bottom: 1rem;
        }
        
        .book-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 1rem;
            border-top: 1px solid #f1f3f4;
        }
        
        .book-stats {
            font-size: 0.8125rem;
            color: #80868b;
        }
        
        .read-btn {
            color: #1a73e8;
            font-weight: 600;
            font-size: 0.875rem;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            overflow-y: auto;
        }
        
        .modal-content {
            background: white;
            max-width: 600px;
            margin: 3rem auto;
            border-radius: 12px;
            padding: 2.5rem;
            position: relative;
            box-shadow: 0 8px 32px rgba(0,0,0,0.12);
        }
        
        .modal-content-large {
            max-width: 900px;
        }
        
        .close-btn {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            font-size: 1.5rem;
            cursor: pointer;
            color: #5f6368;
            background: none;
            border: none;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s;
        }
        
        .close-btn:hover {
            background: #f1f3f4;
            color: #202124;
        }
        
        .modal-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: #202124;
            margin-bottom: 2rem;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #202124;
            font-size: 0.875rem;
        }
        
        .form-control {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid #dadce0;
            border-radius: 8px;
            font-size: 0.9375rem;
            font-family: inherit;
            transition: all 0.2s;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #1a73e8;
            box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.1);
        }
        
        textarea.form-control {
            min-height: 120px;
            resize: vertical;
        }
        
        .auth-divider {
            text-align: center;
            margin: 1.5rem 0;
            color: #5f6368;
            font-size: 0.875rem;
        }
        
        .auth-toggle {
            text-align: center;
            margin-top: 1.5rem;
            font-size: 0.875rem;
            color: #5f6368;
        }
        
        .auth-toggle a {
            color: #1a73e8;
            cursor: pointer;
            text-decoration: none;
            font-weight: 600;
        }
        
        .auth-toggle a:hover {
            text-decoration: underline;
        }
        
        .book-detail-cover {
            width: 100%;
            max-height: 400px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 2rem;
        }
        
        .book-detail-title {
            font-size: 2rem;
            font-weight: 700;
            color: #202124;
            margin-bottom: 0.5rem;
        }
        
        .book-detail-author {
            font-size: 1.125rem;
            color: #5f6368;
            margin-bottom: 2rem;
        }
        
        .book-content {
            background: #f8f9fa;
            padding: 2rem;
            border-radius: 8px;
            margin: 2rem 0;
            line-height: 1.8;
            white-space: pre-wrap;
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid #e9ecef;
        }
        
        .book-content::-webkit-scrollbar {
            width: 8px;
        }
        
        .book-content::-webkit-scrollbar-track {
            background: #f1f3f4;
            border-radius: 4px;
        }
        
        .book-content::-webkit-scrollbar-thumb {
            background: #dadce0;
            border-radius: 4px;
        }
        
        .book-content::-webkit-scrollbar-thumb:hover {
            background: #bdc1c6;
        }
        
        .loading {
            text-align: center;
            padding: 4rem 2rem;
            color: #5f6368;
        }
        
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
        }
        
        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }
        
        .empty-state-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #202124;
            margin-bottom: 0.5rem;
        }
        
        .empty-state-text {
            color: #5f6368;
            margin-bottom: 2rem;
        }
        
        .image-preview {
            margin-top: 1rem;
            max-width: 200px;
            border-radius: 8px;
            border: 1px solid #e9ecef;
            display: none;
        }
        
        @media (max-width: 768px) {
            .hero h2 {
                font-size: 2rem;
            }
            
            .books-grid {
                grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
                gap: 1.5rem;
            }
            
            .modal-content {
                margin: 1rem;
                padding: 2rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo-section">
                <span class="logo-icon">üìö</span>
                <h1>Sahitya Mela</h1>
            </div>
            <div class="header-actions">
                <div class="user-info" id="userInfo">
                    <span class="user-email" id="userEmail"></span>
                    <button class="btn btn-secondary" onclick="handleLogout()">Logout</button>
                </div>
                <button class="btn btn-outline" id="authBtn" onclick="openAuthModal()">Sign In</button>
                <button class="btn btn-primary" id="uploadBtn" style="display: none;" onclick="openUploadModal()">Upload Book</button>
            </div>
        </div>
    </header>
    
    <div class="hero">
        <div class="container">
            <h2>Professional Book Publishing Platform</h2>
            <p>Share your stories with the world. Discover amazing books from talented authors.</p>
        </div>
    </div>
    
    <div class="container">
        <div class="section-header">
            <h3 class="section-title">Latest Books</h3>
        </div>
        
        <div class="books-grid" id="booksGrid">
            <div class="loading">Loading books...</div>
        </div>
    </div>
    
    <!-- Auth Modal -->
    <div id="authModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeAuthModal()">&times;</button>
            <h2 class="modal-title" id="authTitle">Sign In</h2>
            <form id="authForm">
                <div class="form-group">
                    <label class="form-label">Email Address</label>
                    <input type="email" class="form-control" id="authEmail" required placeholder="you@example.com">
                </div>
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-control" id="authPassword" required placeholder="Enter your password">
                </div>
                <button type="submit" class="btn btn-primary" id="authSubmitBtn" style="width: 100%;">Sign In</button>
            </form>
            <div class="auth-toggle">
                <span id="authToggleText">Don't have an account? <a onclick="toggleAuthMode()">Sign Up</a></span>
            </div>
        </div>
    </div>
    
    <!-- Upload Modal -->
    <div id="uploadModal" class="modal">
        <div class="modal-content modal-content-large">
            <button class="close-btn" onclick="closeUploadModal()">&times;</button>
            <h2 class="modal-title">Upload Your Book</h2>
            <form id="uploadForm">
                <div class="form-group">
                    <label class="form-label">Book Title *</label>
                    <input type="text" class="form-control" id="bookTitle" required placeholder="Enter book title">
                </div>
                <div class="form-group">
                    <label class="form-label">Author Name *</label>
                    <input type="text" class="form-control" id="bookAuthor" required placeholder="Enter author name">
                </div>
                <div class="form-group">
                    <label class="form-label">Book Cover Image URL</label>
                    <input type="url" class="form-control" id="bookCover" placeholder="https://example.com/cover.jpg">
                    <img id="coverPreview" class="image-preview" alt="Cover preview">
                </div>
                <div class="form-group">
                    <label class="form-label">Description *</label>
                    <textarea class="form-control" id="bookDescription" required placeholder="Brief description of your book"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Book Content *</label>
                    <textarea class="form-control" id="bookContent" required placeholder="Paste your book content here..." style="min-height: 250px;"></textarea>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Publish Book</button>
            </form>
        </div>
    </div>
    
    <!-- Read Book Modal -->
    <div id="readModal" class="modal">
        <div class="modal-content modal-content-large">
            <button class="close-btn" onclick="closeReadModal()">&times;</button>
            <div id="bookDetails"></div>
        </div>
    </div>
    
    <script>
        // Initialize Supabase - REPLACE WITH YOUR CREDENTIALS
        const SUPABASE_URL = 'YOUR_SUPABASE_URL';
        const SUPABASE_KEY = 'YOUR_SUPABASE_ANON_KEY';
        
        let supabaseClient = null;
        let currentUser = null;
        let isSignUp = false;
        
        // Try to initialize Supabase if credentials are provided
        try {
            if (SUPABASE_URL !== 'YOUR_SUPABASE_URL' && SUPABASE_KEY !== 'YOUR_SUPABASE_ANON_KEY') {
                supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
            }
        } catch (error) {
            console.log('Supabase not configured, using demo mode');
        }
        
        // Demo books for when Supabase is not configured
        const demoBooks = [
            {
                id: 1,
                title: "The Midnight Garden",
                author: "Priya Sharma",
                cover: "https://images.unsplash.com/photo-1544947950-fa07a98d237f?w=800&q=80",
                description: "A magical tale of a young girl who discovers a secret garden that only appears at midnight.",
                content: "Chapter 1: The Discovery\n\nIt was a warm summer night when Maya first noticed the strange glow coming from behind the old wall. The moonlight seemed to dance differently there, casting shadows that moved against the wind...",
                created_at: new Date().toISOString()
            },
            {
                id: 2,
                title: "Echoes of Tomorrow",
                author: "Arjun Mehta",
                cover: "https://images.unsplash.com/photo-1495446815901-a7297e633e8d?w=800&q=80",
                description: "A science fiction thriller about time travel and the consequences of changing the past.",
                content: "Prologue\n\nThe machine hummed with an otherworldly energy. Dr. Kapoor knew that once he stepped through, nothing would ever be the same...",
                created_at: new Date().toISOString()
            },
            {
                id: 3,
                title: "Monsoon Memories",
                author: "Kavita Desai",
                cover: "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=800&q=80",
                description: "A heartwarming collection of stories about love, loss, and finding home during the monsoon season.",
                content: "Story 1: The First Rain\n\nThe smell of wet earth filled the air as the first drops fell on the parched ground...",
                created_at: new Date().toISOString()
            }
        ];
        
        // Check auth state on load
        async function initAuth() {
            if (supabaseClient) {
                const { data: { user } } = await supabaseClient.auth.getUser();
                if (user) {
                    currentUser = user;
                    updateUIForAuth(true);
                }
            }
            loadBooks();
        }
        
        function updateUIForAuth(isAuthenticated) {
            const authBtn = document.getElementById('authBtn');
            const uploadBtn = document.getElementById('uploadBtn');
            const userInfo = document.getElementById('userInfo');
            const userEmail = document.getElementById('userEmail');
            
            if (isAuthenticated) {
                authBtn.style.display = 'none';
                uploadBtn.style.display = 'block';
                userInfo.style.display = 'flex';
                userEmail.textContent = currentUser.email;
            } else {
                authBtn.style.display = 'block';
                uploadBtn.style.display = 'none';
                userInfo.style.display = 'none';
            }
        }
        
        function openAuthModal() {
            document.getElementById('authModal').style.display = 'block';
        }
        
        function closeAuthModal() {
            document.getElementById('authModal').style.display = 'none';
        }
        
        function toggleAuthMode() {
            isSignUp = !isSignUp;
            const title = document.getElementById('authTitle');
            const submitBtn = document.getElementById('authSubmitBtn');
            const toggleText = document.getElementById('authToggleText');
            
            if (isSignUp) {
                title.textContent = 'Create Account';
                submitBtn.textContent = 'Sign Up';
                toggleText.innerHTML = 'Already have an account? <a onclick="toggleAuthMode()">Sign In</a>';
            } else {
                title.textContent = 'Sign In';
                submitBtn.textContent = 'Sign In';
                toggleText.innerHTML = 'Don\'t have an account? <a onclick="toggleAuthMode()">Sign Up</a>';
            }
        }
        
        document.getElementById('authForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!supabaseClient) {
                alert('‚ö†Ô∏è Authentication is not configured. Please set up Supabase credentials.');
                return;
            }
            
            const email = document.getElementById('authEmail').value;
            const password = document.getElementById('authPassword').value;
            
            try {
                if (isSignUp) {
                    const { data, error } = await supabaseClient.auth.signUp({ email, password });
                    if (error) throw error;
                    alert('‚úÖ Account created! Please check your email to verify.');
                } else {
                    const { data, error } = await supabaseClient.auth.signInWithPassword({ email, password });
                    if (error) throw error;
                    currentUser = data.user;
                    updateUIForAuth(true);
                    closeAuthModal();
                    alert('‚úÖ Signed in successfully!');
                }
            } catch (error) {
                alert('‚ùå Error: ' + error.message);
            }
        });
        
        async function handleLogout() {
            if (supabaseClient) {
                await supabaseClient.auth.signOut();
            }
            currentUser = null;
            updateUIForAuth(false);
            alert('‚úÖ Logged out successfully!');
        }
        
        // Image preview
        document.getElementById('bookCover')?.addEventListener('input', function(e) {
            const preview = document.getElementById('coverPreview');
            if (e.target.value) {
                preview.src = e.target.value;
                preview.style.display = 'block';
            } else {
                preview.style.display = 'none';
            }
        });
        
        async function loadBooks() {
            try {
                if (supabaseClient) {
                    const { data: books, error } = await supabaseClient
                        .from('books')
                        .select('*')
                        .order('created_at', { ascending: false });
                    
                    if (error) throw error;
                    renderBooks(books && books.length > 0 ? books : demoBooks);
                } else {
                    renderBooks(demoBooks);
                }
            } catch (error) {
                console.error('Error loading books:', error);
                renderBooks(demoBooks);
            }
        }
        
        function renderBooks(books) {
            const grid = document.getElementById('booksGrid');
            
            if (books.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <div class="empty-state-icon">üìö</div>
                        <h3 class="empty-state-title">No books yet</h3>
                        <p class="empty-state-text">Be the first to share your story!</p>
                        <button class="btn btn-primary" onclick="openUploadModal()">Upload Your First Book</button>
                    </div>
                `;
                return;
            }
            
            grid.innerHTML = books.map(book => `
                <div class="book-card" onclick="openBook(${book.id})">
                    ${book.cover ? 
                        `<div class="book-cover" style="background-image: url('${book.cover}')"></div>` :
                        `<div class="book-cover-placeholder">üìñ</div>`
                    }
                    <div class="book-info">
                        <div class="book-title">${book.title}</div>
                        <div class="book-author">by ${book.author}</div>
                        <div class="book-description">${book.description}</div>
                        <div class="book-footer">
                            <span class="book-stats">üìñ Available</span>
                            <span class="read-btn">Read ‚Üí</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        function openUploadModal() {
            if (!currentUser && supabaseClient) {
                alert('Please sign in to upload books');
                openAuthModal();
                return;
            }
            document.getElementById('uploadModal').style.display = 'block';
        }
        
        function closeUploadModal() {
            document.getElementById('uploadModal').style.display = 'none';
        }
        
        async function openBook(bookId) {
            let book;
            
            try {
                if (supabaseClient) {
                    const { data, error } = await supabaseClient
                        .from('books')
                        .select('*')
                        .eq('id', bookId)
                        .single();
                    
                    if (error) throw error;
                    book = data;
                } else {
                    book = demoBooks.find(b => b.id === bookId);
                }
                
                const modal = document.getElementById('readModal');
                const details = document.getElementById('bookDetails');
                
                details.innerHTML = `
                    ${book.cover ? `<img src="${book.cover}" class="book-detail-cover" alt="${book.title}">` : ''}
                    <h2 class="book-detail-title">${book.title}</h2>
                    <p class="book-detail-author">by ${book.author}</p>
                    <p style="margin-bottom: 1.5rem; color: #5f6368;"><strong>Description:</strong> ${book.description}</p>
                    
                    <div class="book-content">${book.content}</div>
                `;
                
                modal.style.display = 'block';
            } catch (error) {
                alert('Error loading book: ' + error.message);
            }
        }
        
        function closeReadModal() {
            document.getElementById('readModal').style.display = 'none';
        }
        
        document.getElementById('uploadForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!currentUser && supabaseClient) {
                alert('Please sign in to upload books');
                return;
            }
            
            const newBook = {
                title: document.getElementById('bookTitle').value,
                author: document.getElementById('bookAuthor').value,
                cover: document.getElementById('bookCover').value,
                description: document.getElementById('bookDescription').value,
                content: document.getElementById('bookContent').value,
                user_id: currentUser ? currentUser.id : 'demo'
            };
            
            try {
                if (supabaseClient) {
                    const { data, error } = await supabaseClient
                        .from('books')
                        .insert([newBook])
                        .select();
                    
                    if (error) throw error;
                } else {
                    // Demo mode - just add to local array
                    newBook.id = demoBooks.length + 1;
                    newBook.created_at = new Date().toISOString();
                    demoBooks.unshift(newBook);
                }
                
                closeUploadModal();
                document.getElementById('uploadForm').reset();
                document.getElementById('coverPreview').style.display = 'none';
                alert('‚úÖ Book published successfully!');
                loadBooks();
            } catch (error) {
                alert('‚ùå Error publishing book: ' + error.message);
            }
        });
        
        window.onclick = function(event) {
            const uploadModal = document.getElementById('uploadModal');
            const readModal = document.getElementById('readModal');
            const authModal = document.getElementById('authModal');
            if (event.target === uploadModal) {
                closeUploadModal();
            }
            if (event.target === readModal) {
                closeReadModal();
            }
            if (event.target === authModal) {
                closeAuthModal();
            }
        }
        
        // Initialize on page load
        initAuth();
    </script>
</body>
</html>